---
import Layout from "@layouts/Layout.astro";
import HeroBanner from "@components/HeroBanner.astro";
import AboutStrip from "@components/pages/home/AboutStrip.astro";
import ServicesGrid from "@components/services/ServicesGrid.tsx";
import { getCollection } from "astro:content";
import type { ImageMetadata } from "astro";
import type { Service } from "../types/services";

import imgBanner from "@assets/img/home/banner/banner1.jpg";
import imgSello from "@assets/img/home/sello.png";
import { Image } from "astro:assets";

const imageModules = import.meta.glob<{ default: ImageMetadata }>(
  "../assets/img/servicios/*.jpg",
  { eager: true }
);

const services: Service[] = (await getCollection("services"))
  .sort((a, b) => a.data.order - b.data.order)
  .map(({ slug, data }) => {
    const imageModule = imageModules[`../assets/img/servicios/${data.image}`];

    if (!imageModule) {
      throw new Error(`No se encontró la imagen para el servicio "${slug}"`);
    }

    return {
      id: slug,
      title: data.title,
      subtitle: data.subtitle,
      description: data.description,
      image: imageModule.default,
      modal: data.modal,
    } satisfies Service;
  });
---

<Layout headerVariant="dark">
  <HeroBanner backgroundImage={imgBanner} activeBgOverlay={true}>
    <section
      class="container place-self-end justify-self-center
      flex flex-col items-center gap-2
      max-w-5xl text-center mb-12"
    >
      <h1
        class="text-2xl md:text-3xl lg:text-4xl font-semibold text-white leading-relaxed"
      >
        Clínica de Medicina Materno Fetal en México certificada por la Joint
        Commission International (JCI)
      </h1>

      <Image src={imgSello} alt="Logo JCI" class="w-32 md:w-40 lg:w-48" />
    </section>
  </HeroBanner>
  <AboutStrip />
  <section class="bg-primary-grey-100 py-16 lg:py-24">
    <div class="container space-y-12">
      <div class="mx-auto flex max-w-3xl flex-col items-center gap-4 text-center">
        <span class="rounded-full bg-primary-blue-200 px-4 py-1 text-sm font-semibold uppercase tracking-wide text-primary-blue">
          Nuestros estudios
        </span>
        <h2 class="text-3xl font-semibold text-slate-900 md:text-4xl">
          Servicios materno-fetales especializados para cada etapa del embarazo
        </h2>
        <p class="text-base text-slate-600">
          Conoce los 13 estudios disponibles en nuestra clínica para ofrecer un seguimiento integral, oportuno y personalizado a tu embarazo.
        </p>
      </div>
      <ServicesGrid services={services} client:load />
    </div>
  </section>
</Layout>
