---
import type { ImageMetadata } from "astro";
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";
import Layout from "@layouts/Layout.astro";
import HeroBanner from "@components/HeroBanner.astro";
import AboutStrip from "@components/pages/home/AboutStrip.astro";
import DoctorsSection from "@components/doctors/DoctorsSection.astro";
import CtaSection from "@components/pages/home/CtaSection.astro";
import ServicesGrid from "@components/services/ServicesGrid.tsx";
import type { Service } from "../types/services";

import imgBanner from "@assets/img/home/banner/banner1.jpg";
import imgSello from "@assets/img/home/sello.png";
import { Image } from "astro:assets";

const imageModules = import.meta.glob<{ default: ImageMetadata }>(
  "../assets/img/servicios/*.jpg",
  { eager: true }
);
const services: Service[] = (await getCollection("services"))
  .sort((a, b) => a.data.order - b.data.order)
  .map(({ slug, data }: CollectionEntry<"services">) => {
    const imageModule = imageModules[`../assets/img/servicios/${data.image}`];

    if (!imageModule) {
      throw new Error(`No se encontró la imagen para el servicio "${slug}"`);
    }

    return {
      id: slug,
      title: data.title,
      subtitle: data.subtitle,
      description: data.description,
      image: imageModule.default,
      modal: data.modal,
    } satisfies Service;
  });
---

<Layout headerVariant="dark">
  <HeroBanner backgroundImage={imgBanner} activeBgOverlay={true}>
    <section
      class="container place-self-end justify-self-center
      flex flex-col items-center gap-2
      max-w-5xl text-center mb-12"
    >
      <h1
        class="text-2xl md:text-3xl lg:text-4xl font-semibold text-white leading-relaxed"
      >
        Clínica de Medicina Materno Fetal en México certificada por la Joint
        Commission International (JCI)
      </h1>

      <Image src={imgSello} alt="Logo JCI" class="w-32 md:w-40 lg:w-48" />
    </section>
  </HeroBanner>
  <AboutStrip />
  <DoctorsSection
    title="Conozca nuestro equipo de especialistas e interconsultantes"
    description="Trabajamos bajo un enfoque multidisciplinario que nos permite diagnosticar, tratar y ofrecer cuidado continuo a lo largo del embarazo de forma más precisa y segura."
  />
  <section class="py-16 lg:py-24 container mx-auto">
    <div class="space-y-12 lg:space-y-16 mx-auto max-w-7xl">
      <div
        class="mx-auto flex max-w-4xl lg:max-w-5xl flex-col items-center gap-4 text-center"
      >
        <h2 class="text-3xl font-bold text-primary-blue-800 md:text-4xl">
          Estudios para cada etapa de tu embarazo
        </h2>
        <p
          class="text-base md:text-lg lg:text-xl font-light text-primary-grey-800"
        >
          Durante el embarazo, los ultrasonidos son una parte fundamental del
          control prenatal. Nos permiten observar el desarrollo del bebé,
          identificar posibles complicaciones a tiempo y tomar decisiones
          médicas informadas para cuidar tu salud y la de tu bebé.
        </p>
      </div>
      <ServicesGrid services={services} client:load />
    </div>
  </section>
  <CtaSection />
</Layout>
